{"version":3,"sources":["assets/scripts/dialog/dialog - 001.js"],"names":["roleMap","name","url","defaultContents","role","content","cc","Class","Component","properties","picSprite","Sprite","nameLabel","Label","textLabel","nodeBody","Node","onLoad","node","getChildByName","active","canTalk","npcName","initDialog","console","log","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","event","keyCode","macro","KEY","j","canShowDialog","showDialog","start","Global","itemType","initContent","currentScene","Dialog","contents","itemName","nowText","textEnd","tt","contentArr","textIndex","getComponent","string","length","setTextData","closeDialog","textData","resources","load","SpriteFrame","err","texture","spriteFrame","showContext","dt","slice","update","onDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\n\nlet roleMap = {\n    1: {\n        name: \"player\",\n        url: \"role/player\"\n    },\n    2: {\n        name: \"npc1\",\n        url: \"\"\n    }\n}\n\n\nvar defaultContents = [\n    { role: 2, content: \"Welcome to FZU,hhhhh\" },\n    { role: 1, content: \"Hello,I'm Huiker\" },  //当前的testData\n];\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        picSprite: cc.Sprite,\n        nameLabel: cc.Label,\n        textLabel: cc.Label,\n        nodeBody: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        // this.node.getChildByName(\"body\").active = false;\n        this.nodeBody = this.node.getChildByName(\"body\");\n        this.nodeBody.active = false;\n        this.canTalk = false;\n        this.node.active = true;\n        this.npcName = ' ';\n        this.initDialog();\n        console.log(\"dialog success\");\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    },\n\n    onKeyDown(event) {\n        if (event.keyCode == cc.macro.KEY.j && this.canShowDialog()) {\n            this.nodeBody.active = true;\n            this.showDialog();\n            console.log(\"press j to talk\");\n            console.log(this.node.name);\n        }\n    },\n\n    start() {\n\n    },\n\n    canShowDialog() {\n        if (Global.itemType == \"npcs\") {\n            return true;\n        }\n        return false;\n    },\n\n    //初始化对话内容\n    initContent() {\n        console.log(Global.currentScene);\n        var content = Dialog.contents[Global.currentScene];\n        // console.log(content);\n        if (Global.itemType != 'npcs' || Global.itemName == ' ') {\n            return defaultContents;\n        }\n        return content[Global.itemName];\n    },\n\n\n    //初始化对话系统\n    initDialog() {\n        this.nowText = null;\n        this.textEnd = true;\n        this.tt = 0; //播放的总时长\n        this.contentArr = defaultContents;\n        this.textIndex = -1;\n        this.textLabel = this.nodeBody.getChildByName(\"textLabel\").getComponent(cc.Label);\n        this.nameLabel = this.nodeBody.getChildByName(\"nameLabel\").getComponent(cc.Label);\n        this.textLabel.string = '';\n    },\n\n    // 显示对话的逻辑\n    showDialog() {\n        if (++this.textIndex < this.contentArr.length) {\n            console.log(\"current index:\" + this.textIndex);\n            this.setTextData(this.contentArr[this.textIndex]);\n            // console.log(this.contentArr[this.textIndex].content);\n        }\n        else {\n            //关闭对话框\n            this.closeDialog();\n            this.textIndex = -1;\n        }\n    },\n\n    setTextData(textData) {\n        // 一行尚未播放完\n        if (!this.textEnd) return;\n        this.textEnd = false;\n\n        this.nameLabel.string = roleMap[textData.role].name;//textData是角色编号 从roleMap中获取角色的名字\n        this.textLabel.string = '';\n        this.nowText = textData.content;\n\n        // 修改头像\n        if (this.canTalk && this.npcName!=' ') {\n            roleMap[2].url = \"role/\"+Global.currentScene+\"/\"+Global.itemName;\n            console.log(roleMap[textData.role].url)\n        }\n        cc.resources.load(roleMap[textData.role].url, cc.SpriteFrame, (err, texture) => {\n            this.picSprite.spriteFrame = texture;\n        })\n    },\n\n    showContext(dt) {\n        if (!this.nowText) return;\n        this.tt += dt;\n\n        if (this.tt >= 0.02) {    \n            if (this.textLabel.string.length < this.nowText.length) {\n                this.textLabel.string = this.nowText.slice(0, this.textLabel.string.length + 1);\n            } else {\n                this.textEnd = true;\n                this.nowText = null;\n            }\n            this.tt = 0;\n        }\n        console.log(\"this textLabel: \" + this.textLabel.string);\n    },\n\n    closeDialog() {\n        // 直接不显示当前的节点\n        this.nodeBody.active = false;\n    },\n\n    update(dt) {\n        this.canTalk = this.canShowDialog();\n        if (this.canTalk && this.npcName != Global.itemName) {\n            console.log(this.npcName);\n            this.npcName = Global.itemName\n            let content = this.initContent();\n            console.log(content);\n            this.contentArr = content;\n        }\n        if (this.canTalk) {\n            this.showContext(dt);\n        }\n        else {\n            this.nodeBody.active = false;\n        }\n    },\n\n    onDestroy() {\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    },\n\n});\n"]}