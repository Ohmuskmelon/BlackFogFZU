{"version":3,"sources":["assets/scripts/controller/changeScene.js"],"names":["cc","Class","Component","properties","door","Node","playerNode","onLoad","currentScene","director","getScene","_name","nextScene","currentDoor","useItem","find","console","log","name","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","event","canshow","keyCode","macro","KEY","space","saveState","changeScene","canShow","Global","itemType","window","player","pos_X","getPosition","x","pos_Y","y","onSceneLaunched","InUse","i","Bag","length","id","toolMap","tool","TOOLS","self","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","scenes","loadScene","start","update","itemName"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        door:cc.Node,\n        playerNode:cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.currentScene = cc.director.getScene()._name;\n        this.nextScene = '';\n        this.currentDoor = '';\n        this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n        console.log(\"useItem:\"+this.useItem.name);\n        console.log(\"onload\");\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    },\n\n    onKeyDown(event){\n        // console.log(\"press space\");\n        if(this.canshow && event.keyCode == cc.macro.KEY.space){\n            console.log(\"press space\");\n            this.saveState();\n            this.changeScene();\n        }\n    },\n\n    canShow(){\n        return Global.itemType == 'doors';\n    },\n\n    saveState(){\n        window.player.pos_X = this.playerNode.getPosition().x;\n        window.player.pos_Y = this.playerNode.getPosition().y;\n        console.log(window.player.pos_X ,window.player.pos_Y); \n    },\n\n    onSceneLaunched(){\n        if(window.InUse !=''){\n            let i = 0\n            for (; i < window.Bag.length; i++) {\n                if(window.Bag[i].name == window.InUse){\n                    break;\n                }\n            }\n            let id = window.toolMap[window.Bag[i].name];\n            console.log(\"id:\"+ id);\n            let tool = window.TOOLS[id];\n            console.log(\"tool:\"+tool.name);\n            this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n            var self = this.useItem;\n            console.log(\"self out: \"+self.name);\n            cc.loader.loadRes(tool['picUrl'], cc.SpriteFrame, function (err, spriteFrame) {\n                self.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n                console.log(\"self in: \"+self.name);\n            });\n        }\n    },\n\n    changeScene(){\n        let scenes = window.scenes[this.currentScene];\n        console.log(\"scenes: \"+scenes);\n        this.nextScene = scenes[this.currentDoor];\n        console.log(\"next:\"+this.nextScene);\n        cc.director.loadScene(this.nextScene,this.onSceneLaunched);\n        \n    },\n  \n    start () {\n        \n    },\n\n    update () {\n        // console.log(cc.director.getScene()._name);\n        this.canshow = this.canShow();\n        if(Global.itemType!='doors'){\n            this.currentDoor = '';\n        }\n        else{\n            this.currentDoor = Global.itemName;\n        }\n    },\n});\n"]}