
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/controller/player_ctrl_pc - 001.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6e7e0a0TqpJhppp0ePCLXX4', 'player_ctrl_pc - 001');
// scripts/controller/player_ctrl_pc - 001.js

"use strict";

var State = {
  move: 1,
  attack: 2
};
cc.Class({
  "extends": cc.Component,
  properties: {
    moveMaxspeed: 0,
    //最大移动速度
    playerSpeed: 0,
    jumpSpeed: 0,
    jumpHeight: 0
  },
  // LIFE-CYCLE CALLBACKS:
  initHero: function initHero() {
    this.playerNode = cc.find("Canvas/bg/player/body");
    this.rigid = this.playerNode.getComponent(cc.RigidBody);
    this.heroAni = this.playerNode.getComponent(cc.Animation); // 加速度方向开关

    this._dir = ' '; //主角默认动画

    this.anima = 'idle'; //获取npc的位置

    this.npcs = cc.find("Canvas/background/npcs"); //是否可以进行一个交谈

    this.canTalk = false; // console.log(window)

    if (window.player.enterGame) {
      window.player.enterGame = false;
      this.playerNode.setPosition(window.player['pos_X'], window.player['pos_Y']);
    }

    console.log("x:" + this.playerNode.x);
    console.log("y:" + this.playerNode.y);
  },
  onLoad: function onLoad() {
    this.initHero(); // 监听键盘操作

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); //监听鼠标事件 

    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);
  },
  onDestroy: function onDestroy() {
    //对键盘监听事件解绑
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  start: function start() {
    console.log("this.node pos" + this.node.position);
  },
  // 碰撞检测
  onBeginContact: function onBeginContact(contact, selfCollider, otherCollider) {
    if (selfCollider.tag == 0) {
      console.log(selfCollider.tag);
      this.canJump = true;
    }
  },
  // 鼠标事件监听
  onMouseDown: function onMouseDown(event) {},
  //键盘事件监听
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    // console.log("down");
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        console.log("left");
        this._dir = 'left';
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this._dir = 'right';
        break;

      case cc.macro.KEY.w:
      case cc.macro.KEY.up:
        this._dir = 'up';
        break;

      case cc.macro.KEY.s:
      case cc.macro.KEY.down:
        this._dir = 'down';
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        this._dir = ' ';
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this._dir = ' ';
        break;

      case cc.macro.KEY.w:
      case cc.macro.KEY.up:
        this._dir = ' ';
        break;

      case cc.macro.KEY.s:
      case cc.macro.KEY.down:
        this._dir = ' ';
        break;
    }
  },
  //获取npc 和计算npc距离
  //人物移动
  heroMove: function heroMove() {
    var lv = this.rigid.linearVelocity;
    var scaleX = Math.abs(this.node.scaleX);
    var anima = this.anima;

    switch (this._dir) {
      case 'left':
        {
          lv.x = -this.playerSpeed; // this.node.scaleX = -scaleX;

          anima = 'runleft';
          break;
        }

      case 'right':
        {
          lv.x = this.playerSpeed;
          this.node.scaleX = scaleX;
          anima = 'runright';
          break;
        }

      default:
        {
          anima = 'idle';
          lv.x = 0;
        }
    }

    this.playerNode.getComponent(cc.RigidBody).linearVelocity = lv;
    this.setAni(anima);
  },
  setAni: function setAni(anima) {
    if (this.anima == anima) {
      return;
    } else {
      this.anima = anima;
      this.heroAni.play(anima);
    }
  },
  update: function update(dt) {
    if (window.BagBackground && window.BagBackground.active == true || Global.gameBg && Global.gameBg.active == true) {
      return;
    }

    this.heroMove();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2NvbnRyb2xsZXIvcGxheWVyX2N0cmxfcGMgLSAwMDEuanMiXSwibmFtZXMiOlsiU3RhdGUiLCJtb3ZlIiwiYXR0YWNrIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJtb3ZlTWF4c3BlZWQiLCJwbGF5ZXJTcGVlZCIsImp1bXBTcGVlZCIsImp1bXBIZWlnaHQiLCJpbml0SGVybyIsInBsYXllck5vZGUiLCJmaW5kIiwicmlnaWQiLCJnZXRDb21wb25lbnQiLCJSaWdpZEJvZHkiLCJoZXJvQW5pIiwiQW5pbWF0aW9uIiwiX2RpciIsImFuaW1hIiwibnBjcyIsImNhblRhbGsiLCJ3aW5kb3ciLCJwbGF5ZXIiLCJlbnRlckdhbWUiLCJzZXRQb3NpdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJ4IiwieSIsIm9uTG9hZCIsInN5c3RlbUV2ZW50Iiwib24iLCJTeXN0ZW1FdmVudCIsIkV2ZW50VHlwZSIsIktFWV9ET1dOIiwib25LZXlEb3duIiwiS0VZX1VQIiwib25LZXlVcCIsIm5vZGUiLCJOb2RlIiwiTU9VU0VfRE9XTiIsIm9uTW91c2VEb3duIiwib25EZXN0cm95Iiwib2ZmIiwic3RhcnQiLCJwb3NpdGlvbiIsIm9uQmVnaW5Db250YWN0IiwiY29udGFjdCIsInNlbGZDb2xsaWRlciIsIm90aGVyQ29sbGlkZXIiLCJ0YWciLCJjYW5KdW1wIiwiZXZlbnQiLCJrZXlDb2RlIiwibWFjcm8iLCJLRVkiLCJhIiwibGVmdCIsImQiLCJyaWdodCIsInciLCJ1cCIsInMiLCJkb3duIiwiaGVyb01vdmUiLCJsdiIsImxpbmVhclZlbG9jaXR5Iiwic2NhbGVYIiwiTWF0aCIsImFicyIsInNldEFuaSIsInBsYXkiLCJ1cGRhdGUiLCJkdCIsIkJhZ0JhY2tncm91bmQiLCJhY3RpdmUiLCJHbG9iYWwiLCJnYW1lQmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBTUEsS0FBSyxHQUFHO0VBQ1ZDLElB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QUFMO1FBQWM7VUFDVitDLEVBQUUsQ0FBQ3RDLENBQUgsR0FBTyxLQUFLckIsV0FBWjtVQUNBLEtBQUtnQyxJQUFMLENBQVU2QixNQUFWLEdBQW1CQSxNQUFuQjtVQUNBakQsS0FBSyxHQUFHLFVBQVI7VUFDQTtRQUNIOztNQUNEO1FBQVM7VUFDTEEsS0FBSyxHQUFHLE1BQVI7VUFDQStDLEVBQUUsQ0FBQ3RDLENBQUgsR0FBTyxDQUFQO1FBQ0g7SUFoQkw7O0lBa0JBLEtBQUtqQixVQUFMLENBQWdCRyxZQUFoQixDQUE2QlosRUFBRSxDQUFDYSxTQUFoQyxFQUEyQ29ELGNBQTNDLEdBQTRERCxFQUE1RDtJQUNBLEtBQUtLLE1BQUwsQ0FBWXBELEtBQVo7RUFDSCxDQTFKSTtFQTRKTG9ELE1BNUpLLGtCQTRKRXBELEtBNUpGLEVBNEpTO0lBQ1YsSUFBSSxLQUFLQSxLQUFMLElBQWNBLEtBQWxCLEVBQXlCO01BQ3JCO0lBQ0gsQ0FGRCxNQUdLO01BQ0QsS0FBS0EsS0FBTCxHQUFhQSxLQUFiO01BQ0EsS0FBS0gsT0FBTCxDQUFhd0QsSUFBYixDQUFrQnJELEtBQWxCO0lBQ0g7RUFDSixDQXBLSTtFQXdLTHNELE1BQU0sRUFBRSxnQkFBVUMsRUFBVixFQUFjO0lBQ2xCLElBQUlwRCxNQUFNLENBQUNxRCxhQUFQLElBQXdCckQsTUFBTSxDQUFDcUQsYUFBUCxDQUFxQkMsTUFBckIsSUFBOEIsSUFBdkQsSUFDQ0MsTUFBTSxDQUFDQyxNQUFQLElBQWlCRCxNQUFNLENBQUNDLE1BQVAsQ0FBY0YsTUFBZCxJQUF3QixJQUQ3QyxFQUNrRDtNQUM5QztJQUNIOztJQUNELEtBQUtYLFFBQUw7RUFFSDtBQS9LSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTdGF0ZSA9IHtcbiAgICBtb3ZlOiAxLFxuICAgIGF0dGFjazogMixcbn07XG5cbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG1vdmVNYXhzcGVlZDogMCwgICAgLy/mnIDlpKfnp7vliqjpgJ/luqZcbiAgICAgICAgcGxheWVyU3BlZWQ6IDAsXG4gICAgICAgIGp1bXBTcGVlZDogMCxcbiAgICAgICAganVtcEhlaWdodDogMCxcbiAgICB9LFxuXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG4gICAgaW5pdEhlcm8oKSB7XG4gICAgICAgIHRoaXMucGxheWVyTm9kZSA9IGNjLmZpbmQoXCJDYW52YXMvYmcvcGxheWVyL2JvZHlcIik7XG5cblxuICAgICAgICB0aGlzLnJpZ2lkID0gdGhpcy5wbGF5ZXJOb2RlLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xuICAgICAgICB0aGlzLmhlcm9BbmkgPSB0aGlzLnBsYXllck5vZGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG5cblxuICAgICAgICAvLyDliqDpgJ/luqbmlrnlkJHlvIDlhbNcbiAgICAgICAgdGhpcy5fZGlyID0gJyAnO1xuXG4gICAgICAgIC8v5Li76KeS6buY6K6k5Yqo55S7XG4gICAgICAgIHRoaXMuYW5pbWEgPSAnaWRsZSc7XG5cbiAgICAgICAgLy/ojrflj5ZucGPnmoTkvY3nva5cbiAgICAgICAgdGhpcy5ucGNzID0gY2MuZmluZChcIkNhbnZhcy9iYWNrZ3JvdW5kL25wY3NcIik7XG5cbiAgICAgICAgLy/mmK/lkKblj6/ku6Xov5vooYzkuIDkuKrkuqTosIhcbiAgICAgICAgdGhpcy5jYW5UYWxrID0gZmFsc2U7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHdpbmRvdylcbiAgICAgICAgaWYod2luZG93LnBsYXllci5lbnRlckdhbWUpe1xuICAgICAgICAgICAgd2luZG93LnBsYXllci5lbnRlckdhbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyTm9kZS5zZXRQb3NpdGlvbih3aW5kb3cucGxheWVyWydwb3NfWCddLHdpbmRvdy5wbGF5ZXJbJ3Bvc19ZJ10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwieDpcIit0aGlzLnBsYXllck5vZGUueCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwieTpcIit0aGlzLnBsYXllck5vZGUueSk7XG4gICAgfSxcblxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHRoaXMuaW5pdEhlcm8oKTtcblxuICAgICAgICAvLyDnm5HlkKzplK7nm5jmk43kvZxcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7XG5cbiAgICAgICAgLy/nm5HlkKzpvKDmoIfkuovku7YgXG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5NT1VTRV9ET1dOLCB0aGlzLm9uTW91c2VEb3duLCB0aGlzKTtcblxuICAgIH0sXG5cbiAgICBvbkRlc3Ryb3koKSB7XG4gICAgICAgIC8v5a+56ZSu55uY55uR5ZCs5LqL5Lu26Kej57uRXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlEb3duLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub2ZmKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7XG4gICAgfSxcblxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidGhpcy5ub2RlIHBvc1wiKyB0aGlzLm5vZGUucG9zaXRpb24pO1xuICAgIH0sXG5cbiAgICAvLyDnorDmkp7mo4DmtYtcbiAgICBvbkJlZ2luQ29udGFjdDogZnVuY3Rpb24gKGNvbnRhY3QsIHNlbGZDb2xsaWRlciwgb3RoZXJDb2xsaWRlcikge1xuICAgICAgICBpZiAoc2VsZkNvbGxpZGVyLnRhZyA9PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxmQ29sbGlkZXIudGFnKTtcbiAgICAgICAgICAgIHRoaXMuY2FuSnVtcCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG5cbiAgICAvLyDpvKDmoIfkuovku7bnm5HlkKxcbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICB9LFxuXG5cblxuICAgIC8v6ZSu55uY5LqL5Lu255uR5ZCsXG4gICAgb25LZXlEb3duKGV2ZW50KSB7XG4gICAgICAgIC8vIHNldCBhIGZsYWcgd2hlbiBrZXkgcHJlc3NlZFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImRvd25cIik7XG4gICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmxlZnQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsZWZ0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmQ6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5yaWdodDpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXIgPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkudzpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnVwOlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICd1cCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5zOlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXIgPSAnZG93bic7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25LZXlVcChldmVudCkge1xuICAgICAgICAvLyB1bnNldCBhIGZsYWcgd2hlbiBrZXkgcmVsZWFzZWRcbiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkubGVmdDpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXIgPSAnICc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkucmlnaHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlyID0gJyAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkudzpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnVwOlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICcgJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnM6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kb3duOlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICcgJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8v6I635Y+WbnBjIOWSjOiuoeeul25wY+i3neemu1xuXG4gICAgLy/kurrniannp7vliqhcbiAgICBoZXJvTW92ZSgpIHtcbiAgICAgICAgbGV0IGx2ID0gdGhpcy5yaWdpZC5saW5lYXJWZWxvY2l0eTtcbiAgICAgICAgbGV0IHNjYWxlWCA9IE1hdGguYWJzKHRoaXMubm9kZS5zY2FsZVgpO1xuICAgICAgICBsZXQgYW5pbWEgPSB0aGlzLmFuaW1hO1xuICAgICAgICBzd2l0Y2ggKHRoaXMuX2Rpcikge1xuICAgICAgICAgICAgY2FzZSAnbGVmdCc6IHtcbiAgICAgICAgICAgICAgICBsdi54ID0gLXRoaXMucGxheWVyU3BlZWQ7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5ub2RlLnNjYWxlWCA9IC1zY2FsZVg7XG4gICAgICAgICAgICAgICAgYW5pbWEgPSAncnVubGVmdCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6IHtcbiAgICAgICAgICAgICAgICBsdi54ID0gdGhpcy5wbGF5ZXJTcGVlZDtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuc2NhbGVYID0gc2NhbGVYO1xuICAgICAgICAgICAgICAgIGFuaW1hID0gJ3J1bnJpZ2h0JztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBhbmltYSA9ICdpZGxlJztcbiAgICAgICAgICAgICAgICBsdi54ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllck5vZGUuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkgPSBsdjtcbiAgICAgICAgdGhpcy5zZXRBbmkoYW5pbWEpO1xuICAgIH0sXG5cbiAgICBzZXRBbmkoYW5pbWEpIHtcbiAgICAgICAgaWYgKHRoaXMuYW5pbWEgPT0gYW5pbWEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWEgPSBhbmltYTtcbiAgICAgICAgICAgIHRoaXMuaGVyb0FuaS5wbGF5KGFuaW1hKTtcbiAgICAgICAgfVxuICAgIH0sXG5cblxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgaWYoKHdpbmRvdy5CYWdCYWNrZ3JvdW5kICYmIHdpbmRvdy5CYWdCYWNrZ3JvdW5kLmFjdGl2ZSA9PXRydWUpfHxcbiAgICAgICAgICAgIEdsb2JhbC5nYW1lQmcgJiYgR2xvYmFsLmdhbWVCZy5hY3RpdmUgPT0gdHJ1ZSl7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oZXJvTW92ZSgpO1xuXG4gICAgfSxcblxufSk7XG4iXX0=