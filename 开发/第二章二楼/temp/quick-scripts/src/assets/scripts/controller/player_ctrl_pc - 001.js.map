{"version":3,"sources":["assets/scripts/controller/player_ctrl_pc - 001.js"],"names":["State","move","attack","cc","Class","Component","properties","moveMaxspeed","playerSpeed","jumpSpeed","jumpHeight","initHero","playerNode","find","rigid","getComponent","RigidBody","heroAni","Animation","_dir","anima","npcs","canTalk","window","player","enterGame","setPosition","console","log","x","y","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","node","Node","MOUSE_DOWN","onMouseDown","onDestroy","off","start","position","onBeginContact","contact","selfCollider","otherCollider","tag","canJump","event","keyCode","macro","KEY","a","left","d","right","w","up","s","down","heroMove","lv","linearVelocity","scaleX","Math","abs","setAni","play","update","dt","BagBackground","active","Global","gameBg"],"mappings":"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","sourceRoot":"/","sourcesContent":["const State = {\n    move: 1,\n    attack: 2,\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        moveMaxspeed: 0,    //最大移动速度\n        playerSpeed: 0,\n        jumpSpeed: 0,\n        jumpHeight: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    initHero() {\n        this.playerNode = cc.find(\"Canvas/bg/player/body\");\n\n\n        this.rigid = this.playerNode.getComponent(cc.RigidBody);\n        this.heroAni = this.playerNode.getComponent(cc.Animation);\n\n\n        // 加速度方向开关\n        this._dir = ' ';\n\n        //主角默认动画\n        this.anima = 'idle';\n\n        //获取npc的位置\n        this.npcs = cc.find(\"Canvas/background/npcs\");\n\n        //是否可以进行一个交谈\n        this.canTalk = false;\n        // console.log(window)\n        if(window.player.enterGame){\n            window.player.enterGame = false;\n            this.playerNode.setPosition(window.player['pos_X'],window.player['pos_Y']);\n        }\n        console.log(\"x:\"+this.playerNode.x);\n        console.log(\"y:\"+this.playerNode.y);\n    },\n\n    onLoad: function () {\n\n        this.initHero();\n\n        // 监听键盘操作\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        //监听鼠标事件 \n        this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);\n\n    },\n\n    onDestroy() {\n        //对键盘监听事件解绑\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    },\n\n\n    start() {\n        console.log(\"this.node pos\"+ this.node.position);\n    },\n\n    // 碰撞检测\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        if (selfCollider.tag == 0) {\n            console.log(selfCollider.tag);\n            this.canJump = true;\n        }\n    },\n\n\n    // 鼠标事件监听\n    onMouseDown: function (event) {\n\n    },\n\n\n\n    //键盘事件监听\n    onKeyDown(event) {\n        // set a flag when key pressed\n        // console.log(\"down\");\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.left:\n                console.log(\"left\");\n                this._dir = 'left';\n                break;\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                this._dir = 'right';\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                this._dir = 'up';\n                break;\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.down:\n                this._dir = 'down';\n                break;\n        }\n    },\n\n    onKeyUp(event) {\n        // unset a flag when key released\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.left:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.down:\n                this._dir = ' ';\n                break;\n        }\n    },\n\n\n    //获取npc 和计算npc距离\n\n    //人物移动\n    heroMove() {\n        let lv = this.rigid.linearVelocity;\n        let scaleX = Math.abs(this.node.scaleX);\n        let anima = this.anima;\n        switch (this._dir) {\n            case 'left': {\n                lv.x = -this.playerSpeed;\n                // this.node.scaleX = -scaleX;\n                anima = 'runleft';\n                break;\n            }\n            case 'right': {\n                lv.x = this.playerSpeed;\n                this.node.scaleX = scaleX;\n                anima = 'runright';\n                break;\n            }\n            default: {\n                anima = 'idle';\n                lv.x = 0;\n            }\n        }\n        this.playerNode.getComponent(cc.RigidBody).linearVelocity = lv;\n        this.setAni(anima);\n    },\n\n    setAni(anima) {\n        if (this.anima == anima) {\n            return;\n        }\n        else {\n            this.anima = anima;\n            this.heroAni.play(anima);\n        }\n    },\n\n\n\n    update: function (dt) {\n        if((window.BagBackground && window.BagBackground.active ==true)||\n            Global.gameBg && Global.gameBg.active == true){\n            return;\n        }\n        this.heroMove();\n\n    },\n\n});\n"]}