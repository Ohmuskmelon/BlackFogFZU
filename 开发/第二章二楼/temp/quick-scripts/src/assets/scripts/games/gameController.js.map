{"version":3,"sources":["assets/scripts/games/gameController.js"],"names":["cc","Class","Component","properties","tip","Node","playerNode","node","start","scene","Global","currentScene","find","isIn","useItem","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","canStartGame","p_pos","convertToWorldSpaceAR","v2","e_pos","dis","Vec2","distance","console","log","event","keyCode","macro","KEY","g","saveState","changeScene","game","name","nextScene","director","loadScene","onSceneLaunched","window","player","pos_X","getPosition","x","pos_Y","y","enterGame","InUse","i","Bag","length","id","toolMap","tool","TOOLS","self","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","update","dt","itemType","itemName"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tip:cc.Node,\n        playerNode:cc.Node,\n        node:cc.Node\n    },\n\n    start () {\n        this.scene = Global.currentScene;\n        this.tip = cc.find(\"Canvas/Main Camera/tip\");\n        this.isIn = false;\n        this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    },\n\n    canStartGame(){\n        let p_pos = this.playerNode.convertToWorldSpaceAR(cc.v2(0,0));\n        let e_pos =  this.node.convertToWorldSpaceAR(cc.v2(0,0));\n        let dis = cc.Vec2.distance(e_pos, p_pos);\n        console.log(\"dis:\"+dis);\n        if (dis <= 100) {\n            return true;\n        } else {\n            return false;\n        }\n    },\n\n\n    onKeyDown(event) {\n        this.isIn = this.canStartGame();\n        console.log(\"In:\"+this.isIn);\n        if (this.isIn) {\n            if (event.keyCode == cc.macro.KEY.g) {\n                this.saveState();\n                this.changeScene();\n            }\n        }\n    },\n\n    changeScene(){\n        let game = this.node.name;\n        console.log(\"games: \"+game);\n        this.nextScene = game;\n        cc.director.loadScene(this.nextScene,this.onSceneLaunched);\n    },\n\n    saveState(){\n        window.player.pos_X = this.playerNode.getPosition().x;\n        window.player.pos_Y = this.playerNode.getPosition().y;\n        window.player.enterGame = true;\n        console.log(window.player.pos_X ,window.player.pos_Y); \n    },\n\n    onSceneLaunched(){\n        if(window.InUse !=''){\n            let i = 0\n            for (; i < window.Bag.length; i++) {\n                if(window.Bag[i].name == window.InUse){\n                    break;\n                }\n            }\n            let id = window.toolMap[window.Bag[i].name];\n            console.log(\"id:\"+ id);\n            let tool = window.TOOLS[id];\n            console.log(\"tool:\"+tool.name);\n            this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n            var self = this.useItem;\n            console.log(\"self out: \"+self.name);\n            cc.loader.loadRes(tool['picUrl'], cc.SpriteFrame, function (err, spriteFrame) {\n                self.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n                console.log(\"self in: \"+self.name);\n            });\n        }\n    },\n\n\n    update (dt) {\n        if(Global.itemType == 'games' && Global.itemName == this.name){\n            this.enterGame();\n        }   \n    },\n});\n"]}