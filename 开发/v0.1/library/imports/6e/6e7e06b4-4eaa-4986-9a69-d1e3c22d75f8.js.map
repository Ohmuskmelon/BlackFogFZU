{"version":3,"sources":["assets/scripts/controller/player_ctrl_pc - 001.js"],"names":["State","move","attack","cc","Class","Component","properties","moveMaxspeed","playerSpeed","jumpSpeed","jumpHeight","playerNode","Node","initHero","find","rigid","getComponent","RigidBody","heroAni","Animation","_dir","anima","npcs","canTalk","console","log","window","player","enterGame","currentScene","director","getScene","_name","setPosition","position","playerPosition","pos","x","y","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","node","MOUSE_DOWN","onMouseDown","onDestroy","off","start","onBeginContact","contact","selfCollider","otherCollider","tag","canJump","event","keyCode","macro","KEY","a","left","d","right","w","up","s","down","heroMove","lv","linearVelocity","scaleX","Math","abs","setAni","play","update","dt","BagBackground","active","Global","gameBg"],"mappings":"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","sourceRoot":"/","sourcesContent":["const State = {\n    move: 1,\n    attack: 2,\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        moveMaxspeed: 0,    //最大移动速度\n        playerSpeed: 0,\n        jumpSpeed: 0,\n        jumpHeight: 0,\n        playerNode :cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    initHero() {\n        this.playerNode = cc.find(\"Canvas/bg/player\");\n\n\n        this.rigid = this.playerNode.getComponent(cc.RigidBody);\n        this.heroAni = this.playerNode.getComponent(cc.Animation);\n\n\n        // 加速度方向开关\n        this._dir = ' ';\n\n        //主角默认动画\n        this.anima = 'idle';\n\n        //获取npc的位置\n        this.npcs = cc.find(\"Canvas/background/npcs\");\n\n        //是否可以进行一个交谈\n        this.canTalk = false;\n        console.log(\"enterGame:\"+window.player.enterGame);\n        this.currentScene = cc.director.getScene()._name;\n\n        if(window.player.enterGame ){\n            window.player.enterGame = false;\n            this.playerNode.setPosition(window.player['pos_X'],window.player['pos_Y']);\n            console.log(\"playerPos\"+this.playerNode.position);\n        }\n        // 场景中，离开场景\n        else if(window.playerPosition[this.currentScene]!=null){\n            let pos = window.playerPosition[this.currentScene]\n            this.playerNode.setPosition(pos.x,pos.y);\n            console.log(\"playerPos\"+this.playerNode.position);\n        }   \n        console.log(\"x:\"+this.playerNode.x);\n        console.log(\"y:\"+this.playerNode.y);\n    },\n\n    onLoad() {\n        console.log(window.player.enterGame);\n        this.initHero();\n\n        // 监听键盘操作\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        //监听鼠标事件 \n        this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);\n\n    },\n\n    onDestroy() {\n        //对键盘监听事件解绑\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    },\n\n\n    start() {\n        console.log(\"this.node pos\"+ this.playerNode.position);\n    },\n\n    // 碰撞检测\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        if (selfCollider.tag == 0) {\n            console.log(selfCollider.tag);\n            this.canJump = true;\n        }\n    },\n\n\n    // 鼠标事件监听\n    onMouseDown: function (event) {\n\n    },\n\n\n\n    //键盘事件监听\n    onKeyDown(event) {\n        // set a flag when key pressed\n        // console.log(\"down\");\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.left:\n                console.log(\"left\");\n                this._dir = 'left';\n                break;\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                this._dir = 'right';\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                this._dir = 'up';\n                break;\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.down:\n                this._dir = 'down';\n                break;\n        }\n    },\n\n    onKeyUp(event) {\n        // unset a flag when key released\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.left:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                this._dir = ' ';\n                break;\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.down:\n                this._dir = ' ';\n                break;\n        }\n    },\n\n\n    //获取npc 和计算npc距离\n\n    //人物移动\n    heroMove() {\n        let lv = this.rigid.linearVelocity;\n        let scaleX = Math.abs(this.node.scaleX);\n        let anima = this.anima;\n        switch (this._dir) {\n            case 'left': {\n                lv.x = -this.playerSpeed;\n                // this.node.scaleX = -scaleX;\n                anima = 'runleft';\n                break;\n            }\n            case 'right': {\n                lv.x = this.playerSpeed;\n                this.node.scaleX = scaleX;\n                anima = 'runright';\n                break;\n            }\n            default: {\n                anima = 'idle';\n                lv.x = 0;\n            }\n        }\n        this.playerNode.getComponent(cc.RigidBody).linearVelocity = lv;\n        this.setAni(anima);\n    },\n\n    setAni(anima) {\n        if (this.anima == anima) {\n            return;\n        }\n        else {\n            this.anima = anima;\n            this.heroAni.play(anima);\n        }\n    },\n\n\n\n    update: function (dt) {\n        if((window.BagBackground && window.BagBackground.active ==true)||\n            Global.gameBg && Global.gameBg.active == true){\n            return;\n        }\n        this.heroMove();\n\n    },\n\n});\n"]}