
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/controller/player_ctrl_pc - 001.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6e7e0a0TqpJhppp0ePCLXX4', 'player_ctrl_pc - 001');
// scripts/controller/player_ctrl_pc - 001.js

"use strict";

var State = {
  move: 1,
  attack: 2
};
cc.Class({
  "extends": cc.Component,
  properties: {
    moveMaxspeed: 0,
    //最大移动速度
    playerSpeed: 0,
    jumpSpeed: 0,
    jumpHeight: 0,
    playerNode: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  initHero: function initHero() {
    this.playerNode = cc.find("Canvas/bg/player");
    this.rigid = this.playerNode.getComponent(cc.RigidBody);
    this.heroAni = this.playerNode.getComponent(cc.Animation); // 加速度方向开关

    this._dir = ' '; //主角默认动画

    this.anima = 'idle'; //获取npc的位置

    this.npcs = cc.find("Canvas/background/npcs"); //是否可以进行一个交谈

    this.canTalk = false;
    console.log("enterGame:" + window.player.enterGame);
    this.currentScene = cc.director.getScene()._name;

    if (window.player.enterGame) {
      window.player.enterGame = false;
      this.playerNode.setPosition(window.player['pos_X'], window.player['pos_Y']);
      console.log("playerPos" + this.playerNode.position);
    } // 场景中，离开场景
    else if (window.playerPosition[this.currentScene] != null) {
      var pos = window.playerPosition[this.currentScene];
      this.playerNode.setPosition(pos.x, pos.y);
      console.log("playerPos" + this.playerNode.position);
    }

    console.log("x:" + this.playerNode.x);
    console.log("y:" + this.playerNode.y);
  },
  onLoad: function onLoad() {
    console.log(window.player.enterGame);
    this.initHero(); // 监听键盘操作

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); //监听鼠标事件 

    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);
  },
  onDestroy: function onDestroy() {
    //对键盘监听事件解绑
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  start: function start() {
    console.log("this.node pos" + this.playerNode.position);
  },
  // 碰撞检测
  onBeginContact: function onBeginContact(contact, selfCollider, otherCollider) {
    if (selfCollider.tag == 0) {
      console.log(selfCollider.tag);
      this.canJump = true;
    }
  },
  // 鼠标事件监听
  onMouseDown: function onMouseDown(event) {},
  //键盘事件监听
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    // console.log("down");
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        console.log("left");
        this._dir = 'left';
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this._dir = 'right';
        break;

      case cc.macro.KEY.w:
      case cc.macro.KEY.up:
        this._dir = 'up';
        break;

      case cc.macro.KEY.s:
      case cc.macro.KEY.down:
        this._dir = 'down';
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
      case cc.macro.KEY.left:
        this._dir = ' ';
        break;

      case cc.macro.KEY.d:
      case cc.macro.KEY.right:
        this._dir = ' ';
        break;

      case cc.macro.KEY.w:
      case cc.macro.KEY.up:
        this._dir = ' ';
        break;

      case cc.macro.KEY.s:
      case cc.macro.KEY.down:
        this._dir = ' ';
        break;
    }
  },
  //获取npc 和计算npc距离
  //人物移动
  heroMove: function heroMove() {
    var lv = this.rigid.linearVelocity;
    var scaleX = Math.abs(this.node.scaleX);
    var anima = this.anima;

    switch (this._dir) {
      case 'left':
        {
          lv.x = -this.playerSpeed; // this.node.scaleX = -scaleX;

          anima = 'runleft';
          break;
        }

      case 'right':
        {
          lv.x = this.playerSpeed;
          this.node.scaleX = scaleX;
          anima = 'runright';
          break;
        }

      default:
        {
          anima = 'idle';
          lv.x = 0;
        }
    }

    this.playerNode.getComponent(cc.RigidBody).linearVelocity = lv;
    this.setAni(anima);
  },
  setAni: function setAni(anima) {
    if (this.anima == anima) {
      return;
    } else {
      this.anima = anima;
      this.heroAni.play(anima);
    }
  },
  update: function update(dt) {
    if (window.BagBackground && window.BagBackground.active == true || Global.gameBg && Global.gameBg.active == true) {
      return;
    }

    this.heroMove();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2NvbnRyb2xsZXIvcGxheWVyX2N0cmxfcGMgLSAwMDEuanMiXSwibmFtZXMiOlsiU3RhdGUiLCJtb3ZlIiwiYXR0YWNrIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJtb3ZlTWF4c3BlZWQiLCJwbGF5ZXJTcGVlZCIsImp1bXBTcGVlZCIsImp1bXBIZWlnaHQiLCJwbGF5ZXJOb2RlIiwiTm9kZSIsImluaXRIZXJvIiwiZmluZCIsInJpZ2lkIiwiZ2V0Q29tcG9uZW50IiwiUmlnaWRCb2R5IiwiaGVyb0FuaSIsIkFuaW1hdGlvbiIsIl9kaXIiLCJhbmltYSIsIm5wY3MiLCJjYW5UYWxrIiwiY29uc29sZSIsImxvZyIsIndpbmRvdyIsInBsYXllciIsImVudGVyR2FtZSIsImN1cnJlbnRTY2VuZSIsImRpcmVjdG9yIiwiZ2V0U2NlbmUiLCJfbmFtZSIsInNldFBvc2l0aW9uIiwicG9zaXRpb24iLCJwbGF5ZXJQb3NpdGlvbiIsInBvcyIsIngiLCJ5Iiwib25Mb2FkIiwic3lzdGVtRXZlbnQiLCJvbiIsIlN5c3RlbUV2ZW50IiwiRXZlbnRUeXBlIiwiS0VZX0RPV04iLCJvbktleURvd24iLCJLRVlfVVAiLCJvbktleVVwIiwibm9kZSIsIk1PVVNFX0RPV04iLCJvbk1vdXNlRG93biIsIm9uRGVzdHJveSIsIm9mZiIsInN0YXJ0Iiwib25CZWdpbkNvbnRhY3QiLCJjb250YWN0Iiwic2VsZkNvbGxpZGVyIiwib3RoZXJDb2xsaWRlciIsInRhZyIsImNhbkp1bXAiLCJldmVudCIsImtleUNvZGUiLCJtYWNybyIsIktFWSIsImEiLCJsZWZ0IiwiZCIsInJpZ2h0IiwidyIsInVwIiwicyIsImRvd24iLCJoZXJvTW92ZSIsImx2IiwibGluZWFyVmVsb2NpdHkiLCJzY2FsZVgiLCJNYXRoIiwiYWJzIiwic2V0QW5pIiwicGxheSIsInVwZGF0ZSIsImR0IiwiQmFnQmFja2dyb3VuZCIsImFjdGl2ZSIsIkdsb2JhbCIs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TCxDQUFZekQsS0FBWjtFQUNILENBcEtJO0VBc0tMeUQsTUF0S0ssa0JBc0tFekQsS0F0S0YsRUFzS1M7SUFDVixJQUFJLEtBQUtBLEtBQUwsSUFBY0EsS0FBbEIsRUFBeUI7TUFDckI7SUFDSCxDQUZELE1BR0s7TUFDRCxLQUFLQSxLQUFMLEdBQWFBLEtBQWI7TUFDQSxLQUFLSCxPQUFMLENBQWE2RCxJQUFiLENBQWtCMUQsS0FBbEI7SUFDSDtFQUNKLENBOUtJO0VBa0xMMkQsTUFBTSxFQUFFLGdCQUFVQyxFQUFWLEVBQWM7SUFDbEIsSUFBSXZELE1BQU0sQ0FBQ3dELGFBQVAsSUFBd0J4RCxNQUFNLENBQUN3RCxhQUFQLENBQXFCQyxNQUFyQixJQUE4QixJQUF2RCxJQUNDQyxNQUFNLENBQUNDLE1BQVAsSUFBaUJELE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixNQUFkLElBQXdCLElBRDdDLEVBQ2tEO01BQzlDO0lBQ0g7O0lBQ0QsS0FBS1gsUUFBTDtFQUVIO0FBekxJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFN0YXRlID0ge1xuICAgIG1vdmU6IDEsXG4gICAgYXR0YWNrOiAyLFxufTtcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgbW92ZU1heHNwZWVkOiAwLCAgICAvL+acgOWkp+enu+WKqOmAn+W6plxuICAgICAgICBwbGF5ZXJTcGVlZDogMCxcbiAgICAgICAganVtcFNwZWVkOiAwLFxuICAgICAgICBqdW1wSGVpZ2h0OiAwLFxuICAgICAgICBwbGF5ZXJOb2RlIDpjYy5Ob2RlLFxuICAgIH0sXG5cbiAgICAvLyBMSUZFLUNZQ0xFIENBTExCQUNLUzpcbiAgICBpbml0SGVybygpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXJOb2RlID0gY2MuZmluZChcIkNhbnZhcy9iZy9wbGF5ZXJcIik7XG5cblxuICAgICAgICB0aGlzLnJpZ2lkID0gdGhpcy5wbGF5ZXJOb2RlLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xuICAgICAgICB0aGlzLmhlcm9BbmkgPSB0aGlzLnBsYXllck5vZGUuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbik7XG5cblxuICAgICAgICAvLyDliqDpgJ/luqbmlrnlkJHlvIDlhbNcbiAgICAgICAgdGhpcy5fZGlyID0gJyAnO1xuXG4gICAgICAgIC8v5Li76KeS6buY6K6k5Yqo55S7XG4gICAgICAgIHRoaXMuYW5pbWEgPSAnaWRsZSc7XG5cbiAgICAgICAgLy/ojrflj5ZucGPnmoTkvY3nva5cbiAgICAgICAgdGhpcy5ucGNzID0gY2MuZmluZChcIkNhbnZhcy9iYWNrZ3JvdW5kL25wY3NcIik7XG5cbiAgICAgICAgLy/mmK/lkKblj6/ku6Xov5vooYzkuIDkuKrkuqTosIhcbiAgICAgICAgdGhpcy5jYW5UYWxrID0gZmFsc2U7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZW50ZXJHYW1lOlwiK3dpbmRvdy5wbGF5ZXIuZW50ZXJHYW1lKTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjYy5kaXJlY3Rvci5nZXRTY2VuZSgpLl9uYW1lO1xuXG4gICAgICAgIGlmKHdpbmRvdy5wbGF5ZXIuZW50ZXJHYW1lICl7XG4gICAgICAgICAgICB3aW5kb3cucGxheWVyLmVudGVyR2FtZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXJOb2RlLnNldFBvc2l0aW9uKHdpbmRvdy5wbGF5ZXJbJ3Bvc19YJ10sd2luZG93LnBsYXllclsncG9zX1knXSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInBsYXllclBvc1wiK3RoaXMucGxheWVyTm9kZS5wb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5Zy65pmv5Lit77yM56a75byA5Zy65pmvXG4gICAgICAgIGVsc2UgaWYod2luZG93LnBsYXllclBvc2l0aW9uW3RoaXMuY3VycmVudFNjZW5lXSE9bnVsbCl7XG4gICAgICAgICAgICBsZXQgcG9zID0gd2luZG93LnBsYXllclBvc2l0aW9uW3RoaXMuY3VycmVudFNjZW5lXVxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJOb2RlLnNldFBvc2l0aW9uKHBvcy54LHBvcy55KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyUG9zXCIrdGhpcy5wbGF5ZXJOb2RlLnBvc2l0aW9uKTtcbiAgICAgICAgfSAgIFxuICAgICAgICBjb25zb2xlLmxvZyhcIng6XCIrdGhpcy5wbGF5ZXJOb2RlLngpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInk6XCIrdGhpcy5wbGF5ZXJOb2RlLnkpO1xuICAgIH0sXG5cbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHdpbmRvdy5wbGF5ZXIuZW50ZXJHYW1lKTtcbiAgICAgICAgdGhpcy5pbml0SGVybygpO1xuXG4gICAgICAgIC8vIOebkeWQrOmUruebmOaTjeS9nFxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vbihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlEb3duLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTtcblxuICAgICAgICAvL+ebkeWQrOm8oOagh+S6i+S7tiBcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLk1PVVNFX0RPV04sIHRoaXMub25Nb3VzZURvd24sIHRoaXMpO1xuXG4gICAgfSxcblxuICAgIG9uRGVzdHJveSgpIHtcbiAgICAgICAgLy/lr7nplK7nm5jnm5HlkKzkuovku7bop6Pnu5FcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub2ZmKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfRE9XTiwgdGhpcy5vbktleURvd24sIHRoaXMpO1xuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vZmYoY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9VUCwgdGhpcy5vbktleVVwLCB0aGlzKTtcbiAgICB9LFxuXG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ0aGlzLm5vZGUgcG9zXCIrIHRoaXMucGxheWVyTm9kZS5wb3NpdGlvbik7XG4gICAgfSxcblxuICAgIC8vIOeisOaSnuajgOa1i1xuICAgIG9uQmVnaW5Db250YWN0OiBmdW5jdGlvbiAoY29udGFjdCwgc2VsZkNvbGxpZGVyLCBvdGhlckNvbGxpZGVyKSB7XG4gICAgICAgIGlmIChzZWxmQ29sbGlkZXIudGFnID09IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGZDb2xsaWRlci50YWcpO1xuICAgICAgICAgICAgdGhpcy5jYW5KdW1wID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8vIOm8oOagh+S6i+S7tuebkeWQrFxuICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIH0sXG5cblxuXG4gICAgLy/plK7nm5jkuovku7bnm5HlkKxcbiAgICBvbktleURvd24oZXZlbnQpIHtcbiAgICAgICAgLy8gc2V0IGEgZmxhZyB3aGVuIGtleSBwcmVzc2VkXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZG93blwiKTtcbiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkubGVmdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImxlZnRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlyID0gJ2xlZnQnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZDpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICdyaWdodCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS53OlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkudXA6XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlyID0gJ3VwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLnM6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kb3duOlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICdkb3duJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbktleVVwKGV2ZW50KSB7XG4gICAgICAgIC8vIHVuc2V0IGEgZmxhZyB3aGVuIGtleSByZWxlYXNlZFxuICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmE6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5sZWZ0OlxuICAgICAgICAgICAgICAgIHRoaXMuX2RpciA9ICcgJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmQ6XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5yaWdodDpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXIgPSAnICc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS53OlxuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkudXA6XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlyID0gJyAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuczpcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmRvd246XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlyID0gJyAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuXG4gICAgLy/ojrflj5ZucGMg5ZKM6K6h566XbnBj6Led56a7XG5cbiAgICAvL+S6uueJqeenu+WKqFxuICAgIGhlcm9Nb3ZlKCkge1xuICAgICAgICBsZXQgbHYgPSB0aGlzLnJpZ2lkLmxpbmVhclZlbG9jaXR5O1xuICAgICAgICBsZXQgc2NhbGVYID0gTWF0aC5hYnModGhpcy5ub2RlLnNjYWxlWCk7XG4gICAgICAgIGxldCBhbmltYSA9IHRoaXMuYW5pbWE7XG4gICAgICAgIHN3aXRjaCAodGhpcy5fZGlyKSB7XG4gICAgICAgICAgICBjYXNlICdsZWZ0Jzoge1xuICAgICAgICAgICAgICAgIGx2LnggPSAtdGhpcy5wbGF5ZXJTcGVlZDtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLm5vZGUuc2NhbGVYID0gLXNjYWxlWDtcbiAgICAgICAgICAgICAgICBhbmltYSA9ICdydW5sZWZ0JztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0Jzoge1xuICAgICAgICAgICAgICAgIGx2LnggPSB0aGlzLnBsYXllclNwZWVkO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5zY2FsZVggPSBzY2FsZVg7XG4gICAgICAgICAgICAgICAgYW5pbWEgPSAncnVucmlnaHQnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIGFuaW1hID0gJ2lkbGUnO1xuICAgICAgICAgICAgICAgIGx2LnggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyTm9kZS5nZXRDb21wb25lbnQoY2MuUmlnaWRCb2R5KS5saW5lYXJWZWxvY2l0eSA9IGx2O1xuICAgICAgICB0aGlzLnNldEFuaShhbmltYSk7XG4gICAgfSxcblxuICAgIHNldEFuaShhbmltYSkge1xuICAgICAgICBpZiAodGhpcy5hbmltYSA9PSBhbmltYSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hbmltYSA9IGFuaW1hO1xuICAgICAgICAgICAgdGhpcy5oZXJvQW5pLnBsYXkoYW5pbWEpO1xuICAgICAgICB9XG4gICAgfSxcblxuXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZigod2luZG93LkJhZ0JhY2tncm91bmQgJiYgd2luZG93LkJhZ0JhY2tncm91bmQuYWN0aXZlID09dHJ1ZSl8fFxuICAgICAgICAgICAgR2xvYmFsLmdhbWVCZyAmJiBHbG9iYWwuZ2FtZUJnLmFjdGl2ZSA9PSB0cnVlKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhlcm9Nb3ZlKCk7XG5cbiAgICB9LFxuXG59KTtcbiJdfQ==