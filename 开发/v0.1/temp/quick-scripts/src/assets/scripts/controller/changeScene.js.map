{"version":3,"sources":["assets/scripts/controller/changeScene.js"],"names":["cc","Class","Component","properties","door","Node","playerNode","onLoad","currentScene","director","getScene","_name","nextScene","currentDoor","useItem","find","console","log","name","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","event","canshow","keyCode","macro","KEY","space","saveState","changeScene","canShow","Global","itemType","camera","window","player","pos_X","getPosition","x","pos_Y","y","playerPosition","onSceneLaunched","InUse","i","Bag","length","id","toolMap","tool","TOOLS","self","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","scenes","curreneScene","previousScene","previousDoor","lockOfCupsInCP1","lockOfWashingMachineInCp1","loadScene","start","update","itemName"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;EACP,WAASD,EAAE,CAACE,SADL;EAGPC,UAAU,EAAE;IACVC,IAAI,EAAEJ,EAAE,CAACK,IADC;IAEVC,UAAU,EAAEN,EAAE,CAACK;EAFL,CAHL;EAQP;EAEAE,MAVO,oBAUE;IACP,KAAKC,YAAL,GAAoBR,EAAE,CAACS,QAAH,CAAYC,QAAZ,GAAuBC,KAA3C;IACA,KAAKC,SAAL,GAAiB,EAAjB;IACA,KAAKC,WAAL,GAAmB,EAAnB;IACA,KAAKC,OAAL,GAAed,EAAE,CAACe,IAAH,CAAQ,qCAAR,CAAf;IACAC,OAAO,CAACC,GAAR,CAAY,aAAa,KAAKH,OAAL,CAAaI,IAAtC;IACAF,OAAO,CAACC,GAAR,CAAY,QAAZ;IACAjB,EAAE,CAACmB,WAAH,CAAeC,EAAf,CAAkBpB,EAAE,CAACqB,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAqD,KAAKC,SAA1D,EAAqE,IAArE;EACD,CAlBM;EAoBPA,SApBO,qBAoBGC,KApBH,EAoBU;IACf;IACA,IAAI,KAAKC,OAAL,IAAgBD,KAAK,CAACE,OAAN,IAAiB3B,EAAE,CAAC4B,KAAH,CAASC,GAAT,CAAaC,KAAlD,EAAyD;MACvDd,OAAO,CAACC,GAAR,CAAY,aAAZ;MACA,KAAKc,SAAL;MACA,KAAKC,WAAL;IACD;EACF,CA3BM;EA6BPC,OA7BO,qBA6BG;IACR,OAAOC,MAAM,CAACC,QAAP,IAAmB,OAA1B;EACD,CA/BM;EAiCPJ,SAjCO,uBAiCK;IACV,IAAIK,MAAM,GAAGpC,EAAE,CAACe,IAAH,CAAQ,aAAR,CAAb;IAEAsB,MAAM,CAACC,MAAP,CAAcC,KAAd,GAAsB,KAAKjC,UAAL,CAAgBkC,WAAhB,GAA8BC,CAApD;IACAJ,MAAM,CAACC,MAAP,CAAcI,KAAd,GAAsB,KAAKpC,UAAL,CAAgBkC,WAAhB,GAA8BG,CAApD;IAEAN,MAAM,CAACO,cAAP,CAAsB,KAAKpC,YAA3B,IAA2C,KAAKF,UAAL,CAAgBkC,WAAhB,EAA3C;IACAxB,OAAO,CAACC,GAAR,CAAYoB,MAAM,CAACC,MAAP,CAAcC,KAA1B,EAAiCF,MAAM,CAACC,MAAP,CAAcI,KAA/C;EACD,CAzCM;EA2CPG,eA3CO,6BA2CW;IAChB,IAAIR,MAAM,CAACS,KAAP,IAAgB,EAApB,EAAwB;MACtB,IAAIC,CAAC,GAAG,CAAR;;MACA,OAAOA,CAAC,GAAGV,MAAM,CAACW,GAAP,CAAWC,MAAtB,EAA8BF,CAAC,EAA/B,EAAmC;QACjC,IAAIV,MAAM,CAACW,GAAP,CAAWD,CAAX,EAAc7B,IAAd,IAAsBmB,MAAM,CAACS,KAAjC,EAAwC;UACtC;QACD;MACF;;MACD,IAAII,EAAE,GAAGb,MAAM,CAACc,OAAP,CAAed,MAAM,CAACW,GAAP,CAAWD,CAAX,EAAc7B,IAA7B,CAAT;MACAF,OAAO,CAACC,GAAR,CAAY,QAAQiC,EAApB;MACA,IAAIE,IAAI,GAAGf,MAAM,CAACgB,KAAP,CAAaH,EAAb,CAAX;MACAlC,OAAO,CAACC,GAAR,CAAY,UAAUmC,IAAI,CAAClC,IAA3B;MACA,KAAKJ,OAAL,GAAed,EAAE,CAACe,IAAH,CAAQ,qCAAR,CAAf;MACA,IAAIuC,IAAI,GAAG,KAAKxC,OAAhB;MACAE,OAAO,CAACC,GAAR,CAAY,eAAeqC,IAAI,CAACpC,IAAhC;MACAlB,EAAE,CAACuD,MAAH,CAAUC,OAAV,CACEJ,IAAI,CAAC,QAAD,CADN,EAEEpD,EAAE,CAACyD,WAFL,EAGE,UAAUC,GAAV,EAAeC,WAAf,EAA4B;QAC1BL,IAAI,CAACM,YAAL,CAAkB5D,EAAE,CAAC6D,MAArB,EAA6BF,WAA7B,GAA2CA,WAA3C;QACA3C,OAAO,CAACC,GAAR,CAAY,cAAcqC,IAAI,CAACpC,IAA/B;MACD,CANH;IAQD;EACF,CAnEM;EAqEPc,WArEO,yBAqEO;IACZ,KAAKxB,YAAL,GAAoBR,EAAE,CAACS,QAAH,CAAYC,QAAZ,GAAuBC,KAA3C;IACA,IAAImD,MAAM,GAAGzB,MAAM,CAACyB,MAAP,CAAc,KAAKtD,YAAnB,CAAb;IACAQ,OAAO,CAACC,GAAR,CAAY,mBAAiB,KAAK8C,YAAlC;IACA/C,OAAO,CAACC,GAAR,CAAY,aAAa6C,MAAzB;IACA9C,OAAO,CAACC,GAAR,CAAY6C,MAAZ;IACA,KAAKlD,SAAL,GAAiBkD,MAAM,CAAC,KAAKjD,WAAN,CAAvB;IACAG,OAAO,CAACC,GAAR,CAAY,UAAU,KAAKL,SAA3B;IAEAyB,MAAM,CAACC,MAAP,CAAc0B,aAAd,GAA8B,KAAKxD,YAAnC;IACA6B,MAAM,CAACC,MAAP,CAAc2B,YAAd,GAA6B,KAAK7D,IAAL,CAAUc,IAAvC;;IAEA,IAAI,KAAKN,SAAL,IAAkB,UAAtB,EAAkC;MAChC,IACEyB,MAAM,CAAC6B,eAAP,IAA0B,CAA1B,IACA7B,MAAM,CAAC8B,yBAAP,IAAoC,CAFtC,EAGE;QACAnD,OAAO,CAACC,GAAR,CAAYoB,MAAM,CAAC6B,eAAnB;QACAlD,OAAO,CAACC,GAAR,CAAYoB,MAAM,CAAC8B,yBAAnB;QACAnD,OAAO,CAACC,GAAR,CAAY,OAAZ;QACA;MACD;IACF,CAtBW,CAuBZ;;;IACAD,OAAO,CAACC,GAAR,CAAY,KAAKL,SAAjB;IACAZ,EAAE,CAACS,QAAH,CAAY2D,SAAZ,CAAsB,KAAKxD,SAA3B,EAAsC,KAAKiC,eAA3C;EACD,CA/FM;EAiGPwB,KAjGO,mBAiGC,CAAE,CAjGH;EAmGPC,MAnGO,oBAmGE;IACP;IACA,KAAK5C,OAAL,GAAe,KAAKO,OAAL,EAAf;;IACA,IAAIC,MAAM,CAACC,QAAP,IAAmB,OAAvB,EAAgC;MAC9B,KAAKtB,WAAL,GAAmB,EAAnB;IACD,CAFD,MAEO;MACL,KAAKA,WAAL,GAAmBqB,MAAM,CAACqC,QAA1B;IACD;EACF;AA3GM,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    door: cc.Node,\n    playerNode: cc.Node,\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.currentScene = cc.director.getScene()._name;\n    this.nextScene = \"\";\n    this.currentDoor = \"\";\n    this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n    console.log(\"useItem:\" + this.useItem.name);\n    console.log(\"onload\");\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n  },\n\n  onKeyDown(event) {\n    // console.log(\"press space\");\n    if (this.canshow && event.keyCode == cc.macro.KEY.space) {\n      console.log(\"press space\");\n      this.saveState();\n      this.changeScene();\n    }\n  },\n\n  canShow() {\n    return Global.itemType == \"doors\";\n  },\n\n  saveState() {\n    let camera = cc.find(\"Main Camera\");\n    \n    window.player.pos_X = this.playerNode.getPosition().x;\n    window.player.pos_Y = this.playerNode.getPosition().y;\n\n    window.playerPosition[this.currentScene] = this.playerNode.getPosition();\n    console.log(window.player.pos_X, window.player.pos_Y);\n  },\n\n  onSceneLaunched() {\n    if (window.InUse != \"\") {\n      let i = 0;\n      for (; i < window.Bag.length; i++) {\n        if (window.Bag[i].name == window.InUse) {\n          break;\n        }\n      }\n      let id = window.toolMap[window.Bag[i].name];\n      console.log(\"id:\" + id);\n      let tool = window.TOOLS[id];\n      console.log(\"tool:\" + tool.name);\n      this.useItem = cc.find(\"Canvas/Main Camera/bag/useTool/body\");\n      var self = this.useItem;\n      console.log(\"self out: \" + self.name);\n      cc.loader.loadRes(\n        tool[\"picUrl\"],\n        cc.SpriteFrame,\n        function (err, spriteFrame) {\n          self.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n          console.log(\"self in: \" + self.name);\n        }\n      );\n    }\n  },\n\n  changeScene() {\n    this.currentScene = cc.director.getScene()._name;\n    let scenes = window.scenes[this.currentScene];\n    console.log(\"current scene:\"+this.curreneScene);\n    console.log(\"scenes: \" + scenes);\n    console.log(scenes);\n    this.nextScene = scenes[this.currentDoor];\n    console.log(\"next:\" + this.nextScene);\n\n    window.player.previousScene = this.currentScene;\n    window.player.previousDoor = this.door.name;\n    \n    if (this.nextScene == \"chp1_202\") {\n      if (\n        window.lockOfCupsInCP1 != 1 ||\n        window.lockOfWashingMachineInCp1 != 1\n      ) {\n        console.log(window.lockOfCupsInCP1);\n        console.log(window.lockOfWashingMachineInCp1);\n        console.log(\"wrong\");\n        return;\n      }\n    }\n    // consol\n    console.log(this.nextScene);\n    cc.director.loadScene(this.nextScene, this.onSceneLaunched);\n  },\n\n  start() {},\n\n  update() {\n    // console.log(cc.director.getScene()._name);\n    this.canshow = this.canShow();\n    if (Global.itemType != \"doors\") {\n      this.currentDoor = \"\";\n    } else {\n      this.currentDoor = Global.itemName;\n    }\n  },\n});\n"]}